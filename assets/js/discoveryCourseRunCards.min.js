'use strict';
window.ENEXT = window.ENEXT || {};
ENEXT.registration = (function($) {

    var BUTTONANCHORCLASS = '.discovery-course-runs-js';

    var template = function(courseRunsData) {
        let courseRunCards = ''
        let courseCardsContainer = ''

        courseRunsData.forEach(function(courseRun) {
            courseRunCards = courseRunCards +
                '<div class="course_card">' +
                '<p><strong>Title: </strong>' + courseRun.title + '</p>' +
                '<p><strong>Short Description: </strong>' + courseRun.short_description + '</p>' +
                '<p><strong>Start: </strong>' + courseRun.start + '</p>' +
                '</div>' +
                '';
        });

        courseCardsContainer = '<div class="course_card_container">' + courseRunCards + '</div>';
        return courseCardsContainer
    }

    var renderCourseRunCard = function(courseRunsData, $anchor) {
        var settings = window[$anchor.data('settings')];
        $anchor.show();
        $anchor.html(template(courseRunsData));
    }

    var renderCards = function(courseRunsData, $anchor) {
        renderCourseRunCard(courseRunsData, $anchor);
    }

    var init = function() {
        ENEXT.getCourseRuns().always(function(data) {
            // data.status only exists on error (e.g. its a jqXHR object)
            var courseRunsData = data.status ? [] : data['results'];
            $(BUTTONANCHORCLASS).each(function(index, elem) {
                var $anchor = $(elem);
                renderCards(courseRunsData, $anchor);
            });
        })
    }

    return {
        init: init
    }

})(jQuery);

ENEXT.registration.init();